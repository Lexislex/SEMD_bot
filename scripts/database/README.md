# Database Cleanup Scripts

–ù–∞–±–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö SEMD Bot (FNSI –∏ User) –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## üìä –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

- **fnsi_data.sqlite** ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –§–ù–°–ò (—Ç–∞–±–ª–∏—Ü–∞ `nsi_passport`)
- **user_data.sqlite** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (—Ç–∞–±–ª–∏—Ü—ã `users`, `users_activity`)

–ü—É—Ç—å: `env/data/`

## üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 1. `clean_fnsi_db.py` ‚Äî –ì–∏–±–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ FNSI

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å –æ–ø—Ü–∏—è–º–∏.

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–∑–µ
poetry run python clean_fnsi_db.py --info

# –£–¥–∞–ª–∏—Ç—å –±–∞–∑—É —Ü–µ–ª–∏–∫–æ–º
poetry run python clean_fnsi_db.py

# –° —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–µ–π
poetry run python clean_fnsi_db.py --backup

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ö–µ–º—É, —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ
poetry run python clean_fnsi_db.py --keep-schema
```

### 2. `clean_all_db.py` ‚Äî –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –±–∞–∑

–£–¥–∞–ª—è–µ—Ç FNSI –∏ User –±–∞–∑—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
poetry run python clean_all_db.py --info

# –£–¥–∞–ª–∏—Ç—å –æ–±–µ –±–∞–∑—ã
poetry run python clean_all_db.py

# –° —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏
poetry run python clean_all_db.py --backup
```

### 3. `clean_fnsi_db_quick.sh` ‚Äî –ë—ã—Å—Ç—Ä–∞—è –æ—á–∏—Å—Ç–∫–∞

–°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± (–±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è).

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
./clean_fnsi_db_quick.sh
# –∏–ª–∏
bash clean_fnsi_db_quick.sh
```

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **DB_CLEANUP_GUIDE.md** ‚Äî –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- **QUICK_REFERENCE.txt** ‚Äî –±—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥

## üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

```bash
# 1. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
poetry run python clean_fnsi_db.py --info

# 2. –û—á–∏—Å—Ç–∏—Ç—å
poetry run python clean_fnsi_db.py

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
poetry run python main.py
```

### –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# 1. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
poetry run python clean_all_db.py --info

# 2. –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è + —É–¥–∞–ª–µ–Ω–∏–µ
poetry run python clean_all_db.py --backup

# 3. –¢–µ—Å—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
poetry run python test_architecture.py

# 4. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
poetry run python main.py
```

### CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```bash
# –ë—ã—Å—Ç—Ä–æ —É–¥–∞–ª–∏—Ç—å –±–µ–∑ –≤–æ–ø—Ä–æ—Å–æ–≤
./scripts/database/clean_fnsi_db_quick.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
poetry run python test_architecture.py
```

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **Python 3.8+** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π sqlite3)
- **Poetry** ‚Äî –¥–ª—è –∑–∞–ø—É—Å–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å python –Ω–∞–ø—Ä—è–º—É—é)
- **–ù–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏

## üõ°Ô∏è –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏

–§–æ—Ä–º–∞—Ç –∏–º—ë–Ω:
```
{db_name}_backup_YYYYMMDD_HHMMSS.sqlite

–ü—Ä–∏–º–µ—Ä—ã:
  fnsi_data_backup_20251101_145000.sqlite
  user_data_backup_20251101_145000.sqlite
```

–°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤: `env/data/`

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –°–∫—Ä–∏–ø—Ç—ã —Ç—Ä–µ–±—É—é—Ç **–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º (–≤–≤–µ–¥–∏—Ç–µ `–¥–∞`)
- `clean_fnsi_db_quick.sh` **—É–¥–∞–ª—è–µ—Ç –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è** (–¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏)
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±–µ–∑ `--backup` –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ
- –ë–î –ø–µ—Ä–µ—Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞

---

**–í–µ—Ä—Å–∏—è:** 1.0.0
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-01
