# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ—á–∏—Å—Ç–∫–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–≤–∞ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è —É–¥–æ–±–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–∑–∞—Ö

- **fnsi_data.sqlite** ‚Äî –¥–∞–Ω–Ω—ã–µ –æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞—Ö –§–ù–°–ò (—Ç–∞–±–ª–∏—Ü–∞ `nsi_passport`)
- **user_data.sqlite** ‚Äî –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (—Ç–∞–±–ª–∏—Ü—ã `users`, `users_activity`)

–û–±–µ –±–∞–∑—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `env/data/`

---

## üßπ –°–∫—Ä–∏–ø—Ç 1: –û—á–∏—Å—Ç–∫–∞ FNSI –±–∞–∑—ã (`clean_fnsi_db.py`)

–ì–∏–±–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ –§–ù–°–ò.

### –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∞–∑–µ

```bash
poetry run python clean_fnsi_db.py --info
```

–í—ã–≤–µ–¥–µ—Ç:
- –ü—É—Ç—å –∫ –±–∞–∑–µ
- –†–∞–∑–º–µ—Ä –≤ MB
- –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –∫–∞–∂–¥–æ–π

### –£–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ö–µ–º—É)

```bash
poetry run python clean_fnsi_db.py --keep-schema
```

–ü–æ–ª–µ–∑–Ω–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü, –Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏.

### –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (—É–¥–∞–ª–∏—Ç—å –±–∞–∑—É)

```bash
poetry run python clean_fnsi_db.py
```

–£–¥–∞–ª–∏—Ç –≤—Å—é –±–∞–∑—É. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ –æ–Ω–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞ —Å –Ω—É–ª–µ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.

### –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–µ–π

```bash
poetry run python clean_fnsi_db.py --backup
```

–ü–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º —Å–æ–∑–¥–∞—Å—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π:
- `fnsi_data_backup_20251101_145000.sqlite`

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—É—Ç—å –∫ –±–∞–∑–µ

```bash
poetry run python clean_fnsi_db.py --info --db-path /path/to/custom/db.sqlite
```

---

## üóëÔ∏è –°–∫—Ä–∏–ø—Ç 2: –ë—ã—Å—Ç—Ä–∞—è –æ—á–∏—Å—Ç–∫–∞ FNSI (`clean_fnsi_db_quick.sh`)

–°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± —É–¥–∞–ª–∏—Ç—å FNSI –±–∞–∑—É **–±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è**.

```bash
./clean_fnsi_db_quick.sh
```

–∏–ª–∏

```bash
bash clean_fnsi_db_quick.sh
```

‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è CI/CD –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## üßπüßπ –°–∫—Ä–∏–ø—Ç 3: –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –±–∞–∑ (`clean_all_db.py`)

–£–¥–∞–ª—è–µ—Ç **–æ–±–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** (FNSI –∏ User) –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

### –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Å–µ—Ö –±–∞–∑–∞—Ö

```bash
poetry run python clean_all_db.py --info
```

–í—ã–≤–µ–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞–∑–º–µ—Ä–µ, —Ç–∞–±–ª–∏—Ü–∞—Ö –∏ –∑–∞–ø–∏—Å—è—Ö –≤ –∫–∞–∂–¥–æ–π –±–∞–∑–µ.

### –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –±–∞–∑

```bash
poetry run python clean_all_db.py
```

–¢—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º.

### –û—á–∏—Å—Ç–∫–∞ —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏

```bash
poetry run python clean_all_db.py --backup
```

–°–æ–∑–¥–∞—Å—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –¥–ª—è –æ–±–µ–∏—Ö –±–∞–∑:
- `fnsi_data_backup_20251101_145000.sqlite`
- `user_data_backup_20251101_145000.sqlite`

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üîç –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤

```bash
# 1. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
poetry run python clean_fnsi_db.py --info

# 2. –û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ FNSI –±–∞–∑—É
poetry run python clean_fnsi_db.py

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
poetry run python main.py
```

### üß™ –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —á–∏—Å—Ç—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

```bash
# 1. –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –Ω–∞ —Å–ª—É—á–∞–π
poetry run python clean_all_db.py --backup

# 2. –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –±–∞–∑—ã
poetry run python clean_all_db.py

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
poetry run python test_architecture.py

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
poetry run python main.py
```

### üöÄ –ë—ã—Å—Ç—Ä–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏

```bash
# –ë—ã—Å—Ç—Ä–æ –æ—á–∏—Å—Ç–∏—Ç—å FNSI –±–µ–∑ –≤–æ–ø—Ä–æ—Å–æ–≤
./clean_fnsi_db_quick.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
poetry run python main.py
```

### üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

```bash
# –û—á–∏—Å—Ç–∏—Ç—å –æ–±–µ –±–∞–∑—ã —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏
poetry run python clean_all_db.py --backup

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ
poetry run python test_architecture.py
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏

- –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã —É–∫–∞–∑–∞–ª–∏ —Ñ–ª–∞–≥ `--backup`
- –û–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `env/data/` —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
- –†–∞–∑–º–µ—Ä—ã –æ–±—ã—á–Ω–æ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ **0.05-0.10 MB**

### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π

- –°–∫—Ä–∏–ø—Ç—ã `clean_fnsi_db.py` –∏ `clean_all_db.py` —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (–≤–≤–µ–¥–∏—Ç–µ `–¥–∞`)
- `clean_fnsi_db_quick.sh` —É–¥–∞–ª—è–µ—Ç –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –î–û —É–¥–∞–ª–µ–Ω–∏—è

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ –≤—ã —Å–ª—É—á–∞–π–Ω–æ —É–¥–∞–ª–∏–ª–∏ –±–∞–∑—É –±–µ–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:

1. **FNSI –±–∞–∑–∞** –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞
2. **User –±–∞–∑–∞** –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –í—Å—è –∏—Å—Ç–æ—Ä–∏—è –ø–æ—Ç–µ—Ä—è–Ω–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--backup` –≤ –±—É–¥—É—â–µ–º!)

---

## üîß Troubleshooting

### –û—à–∏–±–∫–∞: "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞"

```
Error: database is locked
```

**–†–µ—à–µ–Ω–∏–µ:** –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç–∞ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –æ–±—Ä–∞—â–∞—é—â–∏—Ö—Å—è –∫ –ë–î:

```bash
# –ó–∞–≤–µ—Ä—à–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Python
pkill -f "python.*main.py"
```

### –û—à–∏–±–∫–∞: "–ù–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞"

```
PermissionError: [Errno 13] Permission denied
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –ø–∞–ø–∫—É:

```bash
chmod 755 env/data/
chmod 644 env/data/*.sqlite
```

### –ë–∞–∑–∞ –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–ª–∞–≥ `--backup` —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

```bash
poetry run python clean_all_db.py --backup --info
```

---

## üí° –ü—Ä–æ Git –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–í `.gitignore` —É–∂–µ –∏—Å–∫–ª—é—á–µ–Ω—ã —Ñ–∞–π–ª—ã –ë–î:

```gitignore
env/data/*.sqlite
env/data/*_backup_*.sqlite
```

–ü–æ—ç—Ç–æ–º—É –≤–∞—à–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ë–î –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. üéâ

---

## üìû –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

–°–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç:
- **sqlite3** ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å Python
- **pathlib** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –ø—É—Ç—è–º–∏
- **logging** ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- **argparse** ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å CI/CD —Å–∏—Å—Ç–µ–º–∞–º–∏.
